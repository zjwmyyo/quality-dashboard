<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ–‡æ¡£è½¬æ¢å·¥å…·</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Mono:wght@300;400;500&display=swap');

  :root {
    --bg: #080810;
    --surface: #0f0f1a;
    --surface2: #161624;
    --surface3: #1e1e2e;
    --border: #252538;
    --border2: #32324a;
    --accent: #5ee9fc;
    --accent2: #f472b6;
    --accent3: #a78bfa;
    --text: #e2e2f0;
    --text2: #7878a0;
    --text3: #4a4a6a;
    --success: #4ade80;
    --warn: #fbbf24;
    --error: #f87171;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'DM Mono', monospace;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed; inset: 0;
    background:
      radial-gradient(ellipse 60% 40% at 20% 10%, rgba(94,233,252,0.045) 0%, transparent 60%),
      radial-gradient(ellipse 50% 35% at 80% 85%, rgba(167,139,250,0.04) 0%, transparent 60%);
    pointer-events: none; z-index: 0;
  }
  body::after {
    content: '';
    position: fixed; inset: 0;
    background-image:
      linear-gradient(rgba(255,255,255,0.014) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255,255,255,0.014) 1px, transparent 1px);
    background-size: 48px 48px;
    pointer-events: none; z-index: 0;
  }

  .container {
    position: relative; z-index: 1;
    max-width: 920px; margin: 0 auto;
    padding: 52px 24px 80px;
  }

  /* Header */
  header { text-align: center; margin-bottom: 52px; }

  .badge {
    display: inline-flex; align-items: center; gap: 8px;
    font-size: 10px; letter-spacing: 3px; text-transform: uppercase;
    color: var(--accent); border: 1px solid rgba(94,233,252,0.25);
    padding: 5px 14px; border-radius: 20px; margin-bottom: 22px;
  }
  .badge-dot {
    width: 5px; height: 5px; border-radius: 50%;
    background: var(--accent); box-shadow: 0 0 6px var(--accent);
    animation: blink 2s ease-in-out infinite;
  }
  @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.35} }

  h1 {
    font-family: 'Syne', sans-serif;
    font-size: clamp(32px, 5.5vw, 58px);
    font-weight: 800; line-height: 1.1; letter-spacing: -2px;
    background: linear-gradient(135deg, #e2e2f0 30%, var(--accent3) 100%);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    background-clip: text; margin-bottom: 12px;
  }
  .subtitle { color: var(--text2); font-size: 13px; letter-spacing: 0.5px; }

  /* Tabs */
  .tabs { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 24px; }

  .tab-btn {
    padding: 14px 10px;
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 12px; color: var(--text2);
    font-family: 'DM Mono', monospace; font-size: 11px; letter-spacing: 0.5px;
    cursor: pointer; transition: all 0.2s;
    display: flex; flex-direction: column; align-items: center; gap: 8px;
  }
  .tab-btn .ti { font-size: 22px; transition: filter 0.2s; }
  .tab-btn:hover { background: var(--surface2); border-color: var(--border2); color: var(--text); }

  .tab-btn.active { background: var(--surface2); color: var(--text); }
  .tab-btn[data-tab="pdf2png"].active  { border-color: rgba(94,233,252,0.5);  box-shadow: 0 0 18px rgba(94,233,252,0.07); }
  .tab-btn[data-tab="pdf2word"].active { border-color: rgba(244,114,182,0.5); box-shadow: 0 0 18px rgba(244,114,182,0.07); }
  .tab-btn[data-tab="word2pdf"].active { border-color: rgba(167,139,250,0.5); box-shadow: 0 0 18px rgba(167,139,250,0.07); }
  .tab-btn[data-tab="pdf2png"].active  .ti { filter: drop-shadow(0 0 5px var(--accent)); }
  .tab-btn[data-tab="pdf2word"].active .ti { filter: drop-shadow(0 0 5px var(--accent2)); }
  .tab-btn[data-tab="word2pdf"].active .ti { filter: drop-shadow(0 0 5px var(--accent3)); }

  /* Panels */
  .panel { display: none; animation: fadein 0.18s ease; }
  .panel.active { display: block; }
  @keyframes fadein { from{opacity:0;transform:translateY(5px)} to{opacity:1;transform:translateY(0)} }

  /* Dropzone */
  .dropzone {
    border: 1.5px dashed var(--border2); border-radius: 16px;
    padding: 52px 32px; text-align: center; cursor: pointer;
    transition: all 0.22s; background: var(--surface);
    position: relative; overflow: hidden;
  }
  .dropzone::before {
    content: ''; position: absolute; inset: 0;
    background: radial-gradient(circle at 50% 50%, rgba(94,233,252,0.06) 0%, transparent 70%);
    opacity: 0; transition: opacity 0.3s;
  }
  .dropzone:hover::before, .dropzone.drag-over::before { opacity: 1; }
  .dropzone:hover, .dropzone.drag-over { border-color: rgba(94,233,252,0.4); background: var(--surface2); }
  .dropzone.has-file { border-style: solid; border-color: rgba(94,233,252,0.3); padding: 24px 28px; }

  .dz-icon { font-size: 42px; margin-bottom: 14px; display: block; }
  .dz-title { font-family: 'Syne', sans-serif; font-size: 17px; font-weight: 700; margin-bottom: 6px; }
  .dz-sub { color: var(--text2); font-size: 12px; line-height: 1.6; }
  .dz-or { color: var(--text3); font-size: 10px; letter-spacing: 2px; text-transform: uppercase; margin: 14px 0; }

  .btn-select {
    display: inline-block; padding: 9px 22px;
    background: var(--surface3); border: 1px solid var(--border2);
    border-radius: 8px; color: var(--text);
    font-family: 'DM Mono', monospace; font-size: 11px;
    letter-spacing: 0.5px; cursor: pointer; transition: all 0.18s;
  }
  .btn-select:hover { border-color: var(--accent); color: var(--accent); }
  input[type="file"] { display: none; }

  /* File preview inside dropzone */
  .dz-preview {
    display: none; /* shown via JS */
    align-items: center; gap: 14px; text-align: left;
  }
  .dz-prev-icon { font-size: 30px; flex-shrink: 0; }
  .dz-prev-info { flex: 1; min-width: 0; }
  .dz-prev-name { font-size: 13px; color: var(--text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-bottom: 3px; }
  .dz-prev-size { font-size: 11px; color: var(--text2); }
  .dz-prev-change { font-size: 11px; color: var(--text2); text-decoration: underline; cursor: pointer; background: none; border: none; font-family: inherit; flex-shrink: 0; }
  .dz-prev-change:hover { color: var(--accent); }

  /* Options bar */
  .opts {
    display: flex; gap: 16px; flex-wrap: wrap; align-items: center;
    padding: 13px 16px; margin: 14px 0;
    background: var(--surface); border: 1px solid var(--border); border-radius: 10px;
  }
  .opt-g { display: flex; align-items: center; gap: 8px; }
  .opt-l { font-size: 10px; letter-spacing: 1px; text-transform: uppercase; color: var(--text2); white-space: nowrap; }
  .opt-s, .opt-i {
    background: var(--surface2); border: 1px solid var(--border2);
    border-radius: 6px; color: var(--text);
    font-family: 'DM Mono', monospace; font-size: 12px;
    padding: 5px 10px; outline: none; transition: border-color 0.18s; cursor: pointer;
  }
  .opt-s:focus, .opt-i:focus { border-color: var(--accent); }
  .opt-i { width: 150px; }

  /* Info box */
  .info-box {
    display: flex; gap: 10px; align-items: flex-start;
    padding: 11px 14px; border-radius: 8px; margin: 12px 0;
    background: var(--surface); border: 1px solid var(--border);
    font-size: 11px; color: var(--text2); line-height: 1.65;
  }
  .info-box .ii { flex-shrink: 0; font-size: 14px; margin-top: 1px; }
  .info-box strong { color: var(--text); }
  .info-box.warn { border-color: rgba(251,191,36,0.3); background: rgba(251,191,36,0.04); }

  /* Dynamic .doc warning */
  #doc-type-warn {
    display: none;
    padding: 12px 14px; margin: 12px 0;
    background: rgba(251,191,36,0.06); border: 1px solid rgba(251,191,36,0.35);
    border-radius: 8px; font-size: 12px; color: var(--warn); line-height: 1.65;
  }

  /* Convert button */
  .btn-go {
    width: 100%; padding: 15px; margin-top: 4px;
    border: 1px solid transparent; border-radius: 10px;
    font-family: 'Syne', sans-serif; font-size: 14px;
    font-weight: 700; letter-spacing: 2px; text-transform: uppercase;
    cursor: pointer; transition: all 0.2s; position: relative; overflow: hidden;
  }
  .btn-go::after {
    content: ''; position: absolute; inset: 0;
    background: rgba(255,255,255,0.08); opacity: 0; transition: opacity 0.2s;
  }
  .btn-go:hover:not(:disabled)::after { opacity: 1; }
  .btn-go:disabled { opacity: 0.35; cursor: not-allowed; }
  #panel-pdf2png  .btn-go { background: rgba(94,233,252,0.12);  border-color: rgba(94,233,252,0.35);  color: var(--accent); }
  #panel-pdf2word .btn-go { background: rgba(244,114,182,0.12); border-color: rgba(244,114,182,0.35); color: var(--accent2); }
  #panel-word2pdf .btn-go { background: rgba(167,139,250,0.12); border-color: rgba(167,139,250,0.35); color: var(--accent3); }

  /* Status */
  .status-area { margin-top: 14px; }
  .sc {
    display: flex; align-items: flex-start; gap: 10px;
    padding: 12px 14px; border-radius: 8px; font-size: 12px; line-height: 1.6;
    background: var(--surface); border: 1px solid var(--border2);
  }
  .sc.ok    { border-color: rgba(74,222,128,0.3); }
  .sc.error { border-color: rgba(248,113,113,0.3); color: var(--error); }
  .prog-wrap { height: 2px; background: var(--surface3); border-radius: 2px; margin: 10px 0; overflow: hidden; }
  .prog-bar  { height: 100%; border-radius: 2px; background: linear-gradient(90deg, var(--accent), var(--accent3)); transition: width 0.35s ease; }

  /* Results */
  .results-grid {
    display: grid; grid-template-columns: repeat(auto-fill, minmax(145px, 1fr));
    gap: 10px; margin-top: 14px;
  }
  .rc { background: var(--surface); border: 1px solid var(--border); border-radius: 10px; overflow: hidden; transition: all 0.18s; }
  .rc:hover { border-color: rgba(94,233,252,0.4); transform: translateY(-2px); }
  .rc-thumb { width: 100%; height: 108px; object-fit: contain; display: block; background: var(--surface3); padding: 4px; }
  .rc-info { padding: 7px 10px; display: flex; align-items: center; justify-content: space-between; border-top: 1px solid var(--border); }
  .rc-name { font-size: 11px; color: var(--text2); flex: 1; min-width: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
  .btn-dl { background: none; border: none; cursor: pointer; color: var(--accent); font-size: 15px; padding: 2px 4px; transition: transform 0.18s; flex-shrink: 0; }
  .btn-dl:hover { transform: scale(1.3); }

  .btn-zip {
    display: none; width: 100%; margin-top: 12px; padding: 11px;
    border-radius: 8px; background: var(--surface); border: 1px solid var(--border2);
    color: var(--text2); font-family: 'DM Mono', monospace; font-size: 11px; letter-spacing: 0.5px;
    cursor: pointer; transition: all 0.18s; align-items: center; justify-content: center; gap: 8px;
  }
  .btn-zip.show { display: flex; }
  .btn-zip:hover { border-color: var(--accent); color: var(--accent); }
  .btn-zip:disabled { opacity: 0.4; cursor: not-allowed; }

  /* Spinner */
  @keyframes spin { to { transform: rotate(360deg); } }
  .spin {
    display: inline-block; width: 13px; height: 13px;
    border: 2px solid rgba(94,233,252,0.2); border-top-color: var(--accent);
    border-radius: 50%; animation: spin 0.75s linear infinite; flex-shrink: 0;
  }

  /* Print modal */
  #print-modal {
    display: none; position: fixed; inset: 0; z-index: 1000;
    background: rgba(0,0,0,0.88); align-items: center; justify-content: center;
  }
  #print-modal.show { display: flex; }
  .modal-box {
    background: var(--surface2); border: 1px solid var(--border2);
    border-radius: 16px; padding: 32px 28px; max-width: 460px; width: 92%; text-align: center;
  }
  .modal-ico { font-size: 42px; margin-bottom: 14px; }
  .modal-title { font-family: 'Syne', sans-serif; font-size: 20px; font-weight: 700; margin-bottom: 10px; }
  .modal-desc { color: var(--text2); font-size: 12px; line-height: 1.75; margin-bottom: 20px; }
  .modal-desc strong { color: var(--accent3); }
  .modal-steps { text-align: left; margin-bottom: 22px; background: var(--surface3); border: 1px solid var(--border); border-radius: 8px; padding: 14px 16px; }
  .ms { display: flex; gap: 10px; align-items: flex-start; font-size: 12px; color: var(--text2); line-height: 1.6; padding: 3px 0; }
  .ms + .ms { margin-top: 8px; }
  .msn { width: 18px; height: 18px; border-radius: 50%; background: var(--accent3); color: #fff; display: inline-flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 700; flex-shrink: 0; margin-top: 1px; }
  .btn-print-go {
    display: block; width: 100%; padding: 13px; margin-bottom: 10px;
    background: rgba(167,139,250,0.15); border: 1px solid rgba(167,139,250,0.45);
    border-radius: 8px; color: var(--accent3);
    font-family: 'Syne', sans-serif; font-size: 13px; font-weight: 700;
    letter-spacing: 1px; cursor: pointer; transition: all 0.18s;
  }
  .btn-print-go:hover { background: rgba(167,139,250,0.25); }
  .btn-modal-close { font-size: 11px; color: var(--text2); background: none; border: none; cursor: pointer; text-decoration: underline; font-family: inherit; }
  .btn-modal-close:hover { color: var(--text); }

  .footer-note { text-align: center; color: var(--text3); font-size: 11px; letter-spacing: 0.5px; margin-top: 56px; padding-top: 24px; border-top: 1px solid var(--border); }
  .footer-note em { color: var(--success); font-style: normal; }

  @media (max-width: 560px) {
    .tab-btn .tl { display: none; }
    .tab-btn { padding: 14px; }
    .tab-btn .ti { font-size: 24px; }
    .opts { flex-direction: column; align-items: flex-start; gap: 12px; }
    .opt-i { width: 100%; }
  }
</style>
</head>
<body>
<div class="container">

  <header>
    <div class="badge"><span class="badge-dot"></span>Document Toolkit</div>
    <h1>æ–‡æ¡£è½¬æ¢å·¥å…·</h1>
    <p class="subtitle">PDF â†’ PNG &nbsp;Â·&nbsp; PDF â†’ Word &nbsp;Â·&nbsp; Word â†’ PDF &nbsp;Â·&nbsp; å®Œå…¨æœ¬åœ°ï¼Œæ— éœ€ä¸Šä¼ </p>
  </header>

  <div class="tabs">
    <button class="tab-btn active" data-tab="pdf2png"><span class="ti">ğŸ–¼ï¸</span><span class="tl">PDF è½¬ PNG</span></button>
    <button class="tab-btn" data-tab="pdf2word"><span class="ti">ğŸ“„</span><span class="tl">PDF è½¬ Word</span></button>
    <button class="tab-btn" data-tab="word2pdf"><span class="ti">ğŸ“‹</span><span class="tl">Word è½¬ PDF</span></button>
  </div>

  <!-- â•â•â•â• Panel: PDF â†’ PNG â•â•â•â• -->
  <div id="panel-pdf2png" class="panel active">
    <div class="dropzone" id="dz1">
      <div id="dz1-empty">
        <span class="dz-icon">ğŸ—‚ï¸</span>
        <div class="dz-title">æ‹–æ‹½ PDF æ–‡ä»¶åˆ°è¿™é‡Œ</div>
        <div class="dz-sub">æ¯é¡µç‹¬ç«‹å¯¼å‡ºä¸ºé«˜æ¸…å›¾ç‰‡</div>
        <p class="dz-or">or</p>
        <label class="btn-select" for="f1">é€‰æ‹©æ–‡ä»¶</label>
      </div>
      <div class="dz-preview" id="dz1-prev">
        <span class="dz-prev-icon">ğŸ“•</span>
        <div class="dz-prev-info">
          <div class="dz-prev-name" id="dz1-name"></div>
          <div class="dz-prev-size" id="dz1-size"></div>
        </div>
        <button class="dz-prev-change" id="dz1-change">æ›´æ¢æ–‡ä»¶</button>
      </div>
      <input type="file" id="f1" accept=".pdf">
    </div>

    <div class="opts">
      <div class="opt-g">
        <span class="opt-l">åˆ†è¾¨ç‡</span>
        <select class="opt-s" id="dpi">
          <option value="1.5">æ™®é€š (1.5Ã—)</option>
          <option value="2" selected>é«˜æ¸… (2Ã—)</option>
          <option value="3">è¶…æ¸… (3Ã—)</option>
          <option value="4">4K (4Ã—)</option>
        </select>
      </div>
      <div class="opt-g">
        <span class="opt-l">é¡µç èŒƒå›´</span>
        <input class="opt-i" id="pages" type="text" placeholder="ç•™ç©º=å…¨éƒ¨ / 1-3 / 1,3,5">
      </div>
      <div class="opt-g">
        <span class="opt-l">æ ¼å¼</span>
        <select class="opt-s" id="fmt">
          <option value="png" selected>PNG</option>
          <option value="jpeg">JPEG</option>
          <option value="webp">WebP</option>
        </select>
      </div>
    </div>

    <button class="btn-go" id="btn1" disabled>â–¶ å¼€å§‹è½¬æ¢</button>
    <div class="status-area" id="st1"></div>
    <div class="results-grid" id="grid1"></div>
    <button class="btn-zip" id="zip1">â¬‡ &nbsp;æ‰“åŒ…ä¸‹è½½å…¨éƒ¨å›¾ç‰‡ (ZIP)</button>
  </div>

  <!-- â•â•â•â• Panel: PDF â†’ Word â•â•â•â• -->
  <div id="panel-pdf2word" class="panel">
    <div class="dropzone" id="dz2">
      <div id="dz2-empty">
        <span class="dz-icon">ğŸ“‘</span>
        <div class="dz-title">æ‹–æ‹½ PDF æ–‡ä»¶åˆ°è¿™é‡Œ</div>
        <div class="dz-sub">æå–æ–‡å­—å†…å®¹ï¼Œå¯¼å‡ºä¸ºå¯ç¼–è¾‘çš„ .docx æ–‡ä»¶</div>
        <p class="dz-or">or</p>
        <label class="btn-select" for="f2">é€‰æ‹©æ–‡ä»¶</label>
      </div>
      <div class="dz-preview" id="dz2-prev">
        <span class="dz-prev-icon">ğŸ“•</span>
        <div class="dz-prev-info">
          <div class="dz-prev-name" id="dz2-name"></div>
          <div class="dz-prev-size" id="dz2-size"></div>
        </div>
        <button class="dz-prev-change" id="dz2-change">æ›´æ¢æ–‡ä»¶</button>
      </div>
      <input type="file" id="f2" accept=".pdf">
    </div>

    <div class="opts">
      <div class="opt-g">
        <span class="opt-l">æå–æ¨¡å¼</span>
        <select class="opt-s" id="extract">
          <option value="text">çº¯æ–‡å­—</option>
          <option value="layout" selected>ä¿ç•™æ’ç‰ˆç»“æ„</option>
        </select>
      </div>
    </div>

    <div class="info-box warn">
      <span class="ii">âš ï¸</span>
      <div>é€‚ç”¨äº<strong>æ–‡å­—å‹ PDF</strong>ï¼ˆæœ‰æ–‡å­—å±‚ï¼‰ã€‚æ‰«æç‰ˆ / å›¾ç‰‡å‹ PDF æ— æ³•æå–æ–‡å­—ï¼Œå»ºè®®ç”¨ã€ŒPDF è½¬ PNGã€ä»£æ›¿ã€‚</div>
    </div>

    <button class="btn-go" id="btn2" disabled>â–¶ å¼€å§‹è½¬æ¢</button>
    <div class="status-area" id="st2"></div>
  </div>

  <!-- â•â•â•â• Panel: Word â†’ PDF â•â•â•â• -->
  <div id="panel-word2pdf" class="panel">
    <div class="dropzone" id="dz3">
      <div id="dz3-empty">
        <span class="dz-icon">ğŸ“</span>
        <div class="dz-title">æ‹–æ‹½ .docx æ–‡ä»¶åˆ°è¿™é‡Œ</div>
        <div class="dz-sub">æ ‡å‡† .docx æ ¼å¼ Â· æ—§ç‰ˆ .doc éœ€å…ˆåœ¨ Word / WPS å¦å­˜ä¸º .docx</div>
        <p class="dz-or">or</p>
        <label class="btn-select" for="f3">é€‰æ‹©æ–‡ä»¶</label>
      </div>
      <div class="dz-preview" id="dz3-prev">
        <span class="dz-prev-icon">ğŸ“˜</span>
        <div class="dz-prev-info">
          <div class="dz-prev-name" id="dz3-name"></div>
          <div class="dz-prev-size" id="dz3-size"></div>
        </div>
        <button class="dz-prev-change" id="dz3-change">æ›´æ¢æ–‡ä»¶</button>
      </div>
      <input type="file" id="f3" accept=".docx,.doc">
    </div>

    <!-- Only shown when .doc selected -->
    <div id="doc-type-warn">
      âš ï¸ æ£€æµ‹åˆ° <strong>.doc æ—§ç‰ˆæ ¼å¼</strong>ï¼Œæµè§ˆå™¨æ— æ³•ç›´æ¥è§£ææ­¤æ ¼å¼ã€‚<br>
      è¯·å…ˆç”¨ Microsoft Word æˆ– WPS æ‰“å¼€ï¼Œé€‰æ‹©ã€Œå¦å­˜ä¸ºã€â†’ã€Œ.docx æ ¼å¼ã€ï¼Œå†é‡æ–°ä¸Šä¼ ã€‚
    </div>

    <div class="opts">
      <div class="opt-g">
        <span class="opt-l">é¡µé¢å¤§å°</span>
        <select class="opt-s" id="pgsz">
          <option value="A4" selected>A4</option>
          <option value="Letter">Letter</option>
          <option value="A3">A3</option>
        </select>
      </div>
    </div>

    <button class="btn-go" id="btn3" disabled>â–¶ å¼€å§‹è½¬æ¢</button>
    <div class="status-area" id="st3"></div>
  </div>

  <p class="footer-note"><em>ğŸ”’ å®Œå…¨ç¦»çº¿å¤„ç†</em> &nbsp;â€” æ‰€æœ‰æ–‡ä»¶å‡åœ¨æ‚¨çš„è®¾å¤‡æœ¬åœ°è½¬æ¢ï¼Œä¸ä¸Šä¼ è‡³ä»»ä½•æœåŠ¡å™¨</p>
</div>

<!-- Print guide modal -->
<div id="print-modal">
  <div class="modal-box">
    <div class="modal-ico">ğŸ–¨ï¸</div>
    <div class="modal-title">æ–‡æ¡£å·²å°±ç»ªï¼Œè¯·æ‰“å°ä¸º PDF</div>
    <div class="modal-desc">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ‰“å¼€<strong>æ‰“å°å¯¹è¯æ¡†</strong>ï¼ŒæŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œå³å¯ï¼š</div>
    <div class="modal-steps">
      <div class="ms"><span class="msn">1</span><span>åœ¨ã€Œç›®æ ‡æ‰“å°æœº / Destinationã€ä¸­é€‰æ‹© <strong style="color:var(--accent3)">å¦å­˜ä¸º PDF</strong></span></div>
      <div class="ms"><span class="msn">2</span><span>ç‚¹å‡»ã€Œä¿å­˜ / Saveã€ï¼Œé€‰æ‹©ä¿å­˜ä½ç½®å³å¯</span></div>
    </div>
    <button class="btn-print-go" id="btn-do-print">ğŸ–¨ï¸ &nbsp;æ‰“å¼€æ‰“å°å¯¹è¯æ¡†</button>
    <button class="btn-modal-close" id="btn-close-modal">å…³é—­</button>
  </div>
</div>

<!-- â•â• Libraries â•â• -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
<script>
// Load docx.js: jsdelivr â†’ unpkg fallback
(function() {
  var s = document.createElement('script');
  s.src = 'https://cdn.jsdelivr.net/npm/docx@8.5.0/build/index.umd.min.js';
  s.onerror = function() {
    var s2 = document.createElement('script');
    s2.src = 'https://unpkg.com/docx@8.5.0/build/index.umd.min.js';
    document.head.appendChild(s2);
  };
  document.head.appendChild(s);
})();
</script>

<script>
'use strict';

// PDF.js worker
pdfjsLib.GlobalWorkerOptions.workerSrc =
  'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

// â”€â”€ Tabs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.querySelectorAll('.tab-btn').forEach(btn =>
  btn.addEventListener('click', () => {
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById('panel-' + btn.dataset.tab).classList.add('active');
  })
);

// â”€â”€ Utilities â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const fmtSz = b => b < 1024 ? b + ' B' : b < 1048576 ? (b/1024).toFixed(1) + ' KB' : (b/1048576).toFixed(2) + ' MB';

function setSt(id, type, html) {
  const cls = type === 'ok' ? 'ok' : type === 'error' ? 'error' : '';
  const icon = type === 'ok' ? 'âœ…' : type === 'error' ? 'âŒ' : '<span class="spin"></span>';
  document.getElementById(id).innerHTML = `<div class="sc ${cls}"><span>${icon}</span><div>${html}</div></div>`;
}

function setProg(id, pct, msg) {
  document.getElementById(id).innerHTML = `
    <div class="sc"><span class="spin"></span><div>${msg}</div></div>
    <div class="prog-wrap"><div class="prog-bar" style="width:${pct}%"></div></div>`;
}

function dlBlob(blob, name) {
  const u = URL.createObjectURL(blob);
  Object.assign(document.createElement('a'), { href: u, download: name }).click();
  setTimeout(() => URL.revokeObjectURL(u), 5000);
}

function parseRange(str, total) {
  if (!str?.trim()) return Array.from({ length: total }, (_, i) => i + 1);
  const s = new Set();
  str.split(',').forEach(p => {
    p = p.trim();
    if (p.includes('-')) {
      const [a, b] = p.split('-').map(Number);
      for (let i = Math.max(1,a); i <= Math.min(total,b); i++) s.add(i);
    } else { const n = +p; if (n>=1 && n<=total) s.add(n); }
  });
  return [...s].sort((a,b)=>a-b);
}

// â”€â”€ Dropzone factory â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function makeDropzone(cfg) {
  // cfg: { dzId, inputId, emptyId, prevId, nameId, sizeId, changeId, btnId, onFile }
  const dz   = document.getElementById(cfg.dzId);
  const inp  = document.getElementById(cfg.inputId);
  const emEl = document.getElementById(cfg.emptyId);
  const prEl = document.getElementById(cfg.prevId);
  const btn  = document.getElementById(cfg.btnId);

  function show(file) {
    emEl.style.display = 'none';
    prEl.style.display = 'flex';
    dz.classList.add('has-file');
    document.getElementById(cfg.nameId).textContent = file.name;
    document.getElementById(cfg.sizeId).textContent = fmtSz(file.size);
    cfg.onFile(file);
  }

  function reset() {
    emEl.style.display = '';
    prEl.style.display = 'none';
    dz.classList.remove('has-file');
    btn.disabled = true;
    inp.value = '';
    cfg.onFile(null);
  }

  inp.addEventListener('change', e => { if (e.target.files[0]) show(e.target.files[0]); });
  document.getElementById(cfg.changeId).addEventListener('click', e => { e.stopPropagation(); reset(); });
  dz.addEventListener('click', e => {
    if (!dz.classList.contains('has-file') && !['LABEL','BUTTON'].includes(e.target.tagName)) inp.click();
  });
  dz.addEventListener('dragover', e => { e.preventDefault(); dz.classList.add('drag-over'); });
  dz.addEventListener('dragleave', () => dz.classList.remove('drag-over'));
  dz.addEventListener('drop', e => { e.preventDefault(); dz.classList.remove('drag-over'); const f=e.dataTransfer.files[0]; if(f) show(f); });

  return { enable: ()=>{btn.disabled=false;}, disable: ()=>{btn.disabled=true;} };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FEATURE 1 Â· PDF â†’ PNG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let f1 = null;
makeDropzone({ dzId:'dz1', inputId:'f1', emptyId:'dz1-empty', prevId:'dz1-prev',
  nameId:'dz1-name', sizeId:'dz1-size', changeId:'dz1-change', btnId:'btn1',
  onFile(file) {
    f1 = file;
    document.getElementById('st1').innerHTML = '';
    document.getElementById('grid1').innerHTML = '';
    document.getElementById('zip1').classList.remove('show');
    if (file) document.getElementById('btn1').disabled = false;
  }
});

document.getElementById('btn1').addEventListener('click', async () => {
  if (!f1) return;
  const scale = parseFloat(document.getElementById('dpi').value);
  const rangeStr = document.getElementById('pages').value;
  const fmt = document.getElementById('fmt').value;
  const btn = document.getElementById('btn1');
  const gridEl = document.getElementById('grid1');
  const zipBtn = document.getElementById('zip1');

  btn.disabled = true;
  gridEl.innerHTML = '';
  zipBtn.classList.remove('show');

  try {
    setProg('st1', 5, 'æ­£åœ¨åŠ è½½ PDFâ€¦');
    const ab  = await f1.arrayBuffer();
    const pdf = await pdfjsLib.getDocument({ data: ab }).promise;
    const total = pdf.numPages;
    const pages = parseRange(rangeStr, total);
    const base  = f1.name.replace(/\.pdf$/i, '');
    const mimes = { png:'image/png', jpeg:'image/jpeg', webp:'image/webp' };
    const mime  = mimes[fmt] || 'image/png';
    const blobs = [];

    for (let idx = 0; idx < pages.length; idx++) {
      const pn = pages[idx];
      setProg('st1', 10 + Math.round(idx/pages.length * 84), `æ¸²æŸ“ç¬¬ ${pn} é¡µï¼ˆå…± ${pages.length} é¡µï¼‰â€¦`);

      const page = await pdf.getPage(pn);
      const vp   = page.getViewport({ scale });
      const cv   = document.createElement('canvas');
      cv.width = vp.width; cv.height = vp.height;
      await page.render({ canvasContext: cv.getContext('2d'), viewport: vp }).promise;

      const blob = await new Promise(res => cv.toBlob(res, mime, fmt==='png'?undefined:0.94));
      const fname = `${base}_p${String(pn).padStart(3,'0')}.${fmt}`;
      blobs.push({ blob, fname });

      // thumbnail
      const tw=200, th=Math.round(vp.height*(200/vp.width));
      const tc=document.createElement('canvas'); tc.width=tw; tc.height=th;
      tc.getContext('2d').drawImage(cv, 0, 0, tw, th);

      const card = document.createElement('div');
      card.className = 'rc';
      card.innerHTML = `<img class="rc-thumb" src="${tc.toDataURL('image/jpeg',0.7)}">
        <div class="rc-info"><span class="rc-name">ç¬¬ ${pn} é¡µ</span><button class="btn-dl" title="ä¸‹è½½">â¬‡</button></div>`;
      card.querySelector('.btn-dl').addEventListener('click', e => { e.stopPropagation(); dlBlob(blob, fname); });
      gridEl.appendChild(card);
    }

    setSt('st1', 'ok', `è½¬æ¢å®Œæˆï¼å…± <strong>${blobs.length}</strong> å¼ ï¼Œç¼©æ”¾ ${scale}Ã— â‰ˆ ${Math.round(96*scale)} DPI`);

    zipBtn.classList.add('show'); zipBtn.disabled = false;
    zipBtn.onclick = async () => {
      zipBtn.disabled = true; zipBtn.textContent = 'â³ æ‰“åŒ…ä¸­â€¦';
      const zip = new JSZip();
      blobs.forEach(({blob, fname}) => zip.file(fname, blob));
      dlBlob(await zip.generateAsync({ type:'blob', compression:'DEFLATE' }), base+'_images.zip');
      zipBtn.disabled = false; zipBtn.innerHTML = 'â¬‡ &nbsp;æ‰“åŒ…ä¸‹è½½å…¨éƒ¨å›¾ç‰‡ (ZIP)';
    };
  } catch(e) {
    setSt('st1', 'error', 'è½¬æ¢å¤±è´¥ï¼š' + e.message);
  } finally {
    btn.disabled = false;
  }
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FEATURE 2 Â· PDF â†’ Word
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let f2 = null;
makeDropzone({ dzId:'dz2', inputId:'f2', emptyId:'dz2-empty', prevId:'dz2-prev',
  nameId:'dz2-name', sizeId:'dz2-size', changeId:'dz2-change', btnId:'btn2',
  onFile(file) {
    f2 = file;
    document.getElementById('st2').innerHTML = '';
    if (file) document.getElementById('btn2').disabled = false;
  }
});

document.getElementById('btn2').addEventListener('click', async () => {
  if (!f2) return;
  const mode = document.getElementById('extract').value;
  const btn  = document.getElementById('btn2');
  btn.disabled = true;

  try {
    // Wait for docx lib (async loaded)
    setProg('st2', 4, 'æ­£åœ¨æ£€æŸ¥ä¾èµ–åº“â€¦');
    await new Promise((ok, fail) => {
      let n = 0;
      const t = setInterval(() => {
        if (window.docx?.Document) { clearInterval(t); ok(); }
        else if (++n > 80) { clearInterval(t); fail(new Error('docx åº“åŠ è½½è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œååˆ·æ–°é‡è¯•')); }
      }, 150);
    });

    setProg('st2', 10, 'æ­£åœ¨è¯»å– PDFâ€¦');
    const ab  = await f2.arrayBuffer();
    const pdf = await pdfjsLib.getDocument({ data: ab }).promise;
    const total = pdf.numPages;
    const pages = [];

    for (let i = 1; i <= total; i++) {
      setProg('st2', 10 + Math.round(i/total*62), `æå–ç¬¬ ${i} / ${total} é¡µâ€¦`);
      const page = await pdf.getPage(i);
      const tc   = await page.getTextContent();

      let lines;
      if (mode === 'layout') {
        const bkt = {};
        tc.items.forEach(it => {
          if (!it.str) return;
          const y = Math.round(it.transform[5] / 4) * 4;
          (bkt[y] = bkt[y]||[]).push({ x: it.transform[4], s: it.str });
        });
        lines = Object.keys(bkt).map(Number).sort((a,b)=>b-a)
          .map(y => bkt[y].sort((a,b)=>a.x-b.x).map(it=>it.s).join(''))
          .filter(l => l.trim());
      } else {
        lines = [tc.items.map(it=>it.str).join(' ')];
      }
      pages.push({ lines, n: i });
    }

    setProg('st2', 76, 'æ­£åœ¨ç”Ÿæˆ .docxâ€¦');
    const { Document, Paragraph, TextRun, HeadingLevel, PageBreak, Packer } = window.docx;
    const children = [];
    const base = f2.name.replace(/\.pdf$/i, '');

    pages.forEach((pg, idx) => {
      if (idx > 0) children.push(new Paragraph({ children: [new PageBreak()] }));
      children.push(new Paragraph({ text: `ç¬¬ ${pg.n} é¡µ`, heading: HeadingLevel.HEADING_2 }));
      pg.lines.forEach(line => {
        const t = line.trim(); if (!t) return;
        children.push(new Paragraph({ children: [new TextRun({ text: t, size: 22 })], spacing: { after: 100 } }));
      });
    });

    const doc = new Document({ sections: [{ children }] });
    setProg('st2', 94, 'æ­£åœ¨æ‰“åŒ…æ–‡ä»¶â€¦');
    dlBlob(await Packer.toBlob(doc), base + '.docx');
    setSt('st2', 'ok', `è½¬æ¢å®Œæˆï¼å…±å¤„ç† <strong>${total}</strong> é¡µï¼Œ.docx æ–‡ä»¶å·²ä¸‹è½½`);
  } catch(e) {
    setSt('st2', 'error', e.message);
  } finally {
    btn.disabled = false;
  }
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FEATURE 3 Â· Word â†’ PDF
// â”€â”€ CORE FIX: use iframe.contentDocument.write() (same-origin) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// blob: URL â†’ iframe æ˜¯ null originï¼Œè°ƒç”¨ contentWindow.print() ä¼šæŠ¥è·¨åŸŸé”™è¯¯
// æ”¹ç”¨ document.write() ç›´æ¥å†™å…¥å†…å®¹ï¼Œiframe ä¸çˆ¶é¡µé¢åŒæºï¼Œprint() æ­£å¸¸å·¥ä½œ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let f3 = null;
let printReady = null; // stores () => void

makeDropzone({ dzId:'dz3', inputId:'f3', emptyId:'dz3-empty', prevId:'dz3-prev',
  nameId:'dz3-name', sizeId:'dz3-size', changeId:'dz3-change', btnId:'btn3',
  onFile(file) {
    f3 = file;
    document.getElementById('st3').innerHTML = '';
    const warn = document.getElementById('doc-type-warn');
    const btn  = document.getElementById('btn3');

    if (!file) { warn.style.display = 'none'; btn.disabled = true; return; }

    // Strict .doc detection: ends with ".doc" but NOT ".docx"
    const isLegacy = /\.doc$/i.test(file.name) && !/\.docx$/i.test(file.name);
    warn.style.display = isLegacy ? 'block' : 'none';
    btn.disabled = isLegacy; // disable for legacy .doc
  }
});

// Modal
const modal = document.getElementById('print-modal');
document.getElementById('btn-close-modal').addEventListener('click', () => { modal.classList.remove('show'); printReady = null; });
document.getElementById('btn-do-print').addEventListener('click', () => { if (printReady) printReady(); });

document.getElementById('btn3').addEventListener('click', async () => {
  if (!f3) return;
  const btn = document.getElementById('btn3');
  const sz  = document.getElementById('pgsz').value;
  btn.disabled = true;

  const szCss = { A4:'210mm 297mm', Letter:'8.5in 11in', A3:'297mm 420mm' };

  try {
    setProg('st3', 10, 'æ­£åœ¨è§£æ Word æ–‡æ¡£â€¦');
    const ab = await f3.arrayBuffer();

    // Validate ZIP magic (PK = 0x50 0x4B)
    const hdr = new Uint8Array(ab.slice(0, 4));
    if (hdr[0] !== 0x50 || hdr[1] !== 0x4B) {
      throw new Error('æ–‡ä»¶æ ¼å¼æ— æ•ˆï¼ˆéæ ‡å‡† .docxï¼‰ã€‚è¯·ç¡®è®¤æ–‡ä»¶æœªåŠ å¯†ã€æœªæŸåã€‚');
    }

    const { value: html } = await mammoth.convertToHtml({ arrayBuffer: ab });
    if (!html.trim()) throw new Error('æ–‡æ¡£å†…å®¹ä¸ºç©ºï¼Œæ— æ³•è½¬æ¢ã€‚');

    setProg('st3', 68, 'æ­£åœ¨å‡†å¤‡æ‰“å°å†…å®¹â€¦');

    const printHtml = `<!DOCTYPE html><html><head><meta charset="UTF-8"><style>
@page{size:${szCss[sz]||'210mm 297mm'};margin:22mm 20mm}
*{box-sizing:border-box}
body{font-family:'SimSun','Microsoft YaHei','PingFang SC',serif;font-size:12pt;line-height:1.85;color:#111;background:#fff}
h1{font-size:20pt;font-weight:700;margin:18pt 0 9pt}h2{font-size:16pt;font-weight:700;margin:15pt 0 7pt}
h3{font-size:13pt;font-weight:700;margin:12pt 0 6pt}h4,h5,h6{font-size:12pt;font-weight:700;margin:10pt 0 5pt}
p{margin:0 0 7pt;text-align:justify;orphans:3;widows:3}
table{border-collapse:collapse;width:100%;margin:8pt 0;page-break-inside:avoid}
td,th{border:1px solid #aaa;padding:4pt 7pt;vertical-align:top}th{background:#f4f4f4;font-weight:700}
img{max-width:100%;height:auto;display:block}ul,ol{margin:4pt 0 8pt 22pt}li{margin:3pt 0}
strong,b{font-weight:700}em,i{font-style:italic}u{text-decoration:underline}
blockquote{margin:8pt 24pt;padding:4pt 12pt;border-left:3px solid #ccc;color:#555}
pre,code{font-family:monospace;font-size:10pt;background:#f8f8f8;padding:2pt 5pt}
hr{border:none;border-top:1px solid #ddd;margin:12pt 0}
</style></head><body>${html}</body></html>`;

    // â”€â”€â”€ KEY FIX â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Do NOT use iframe.src = blobURL (causes null origin â†’ cross-origin error)
    // Instead: create iframe, use contentDocument.write() â†’ same-origin frame
    const iframe = document.createElement('iframe');
    iframe.style.cssText = 'position:fixed;left:-9999px;top:-9999px;width:1px;height:1px;border:none;';
    document.body.appendChild(iframe);

    // Write HTML directly â†’ no cross-origin issue
    iframe.contentDocument.open();
    iframe.contentDocument.write(printHtml);
    iframe.contentDocument.close();

    // Wait for images / fonts to settle
    await new Promise(r => setTimeout(r, 900));

    setSt('st3', 'info', 'æ–‡æ¡£å·²å°±ç»ªï¼Œè¯·ç‚¹å‡»ã€Œæ‰“å¼€æ‰“å°å¯¹è¯æ¡†ã€å¹¶é€‰æ‹©ã€Œå¦å­˜ä¸º PDFã€ä¿å­˜ã€‚');

    printReady = () => {
      modal.classList.remove('show');
      setTimeout(() => {
        try {
          iframe.contentWindow.focus();
          iframe.contentWindow.print();
        } catch(err) {
          console.warn('iframe.print failed, fallback to window.print', err);
          window.print();
        }
        setTimeout(() => {
          if (document.body.contains(iframe)) document.body.removeChild(iframe);
          printReady = null;
        }, 8000);
      }, 200);
    };

    modal.classList.add('show');

  } catch(e) {
    setSt('st3', 'error', e.message.replace(/\n/g,'<br>'));
  } finally {
    btn.disabled = false;
  }
});
</script>
</body>
</html>
